<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>äº’å‹•è¡›æ˜Ÿåœ°åœ– - å®Œæ•´ä»‹ç´¹ç‰ˆ</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        body, html { margin: 0; padding: 0; height: 100%; overflow: hidden; background: #000; font-family: "PingFang TC", "Microsoft JhengHei", sans-serif; }
        #layout { display: flex; height: 100vh; width: 100vw; }
        #map { flex: 1; background: #001529; }
        
        /* å´é‚Šä»‹ç´¹é¢æ¿ */
        #side-info {
            width: 400px;
            background: #ffffff;
            z-index: 2000;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            border-left: 2px solid #3498db;
            transition: all 0.3s;
        }

        .welcome-screen { padding: 40px; text-align: center; color: #7f8c8d; }
        .content-screen { padding: 25px; display: none; }
        .flag-box { width: 100%; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); margin-bottom: 20px; }
        h1 { color: #2c3e50; margin: 0 0 10px 0; font-size: 2.2em; border-bottom: 2px solid #3498db; padding-bottom: 10px; }
        .detail-row { margin: 12px 0; font-size: 16px; color: #34495e; border-bottom: 1px solid #eee; padding-bottom: 8px; }
        .detail-row b { color: #2980b9; width: 80px; display: inline-block; }
        .history-box { background: #f8f9fa; padding: 15px; border-radius: 8px; line-height: 1.8; color: #444; margin-top: 20px; }
        
        /* åœ°åœ–æ¨™ç±¤ */
        .leaflet-tooltip { background: #000 !important; color: #fff !important; border: 1px solid #00d4ff !important; font-size: 14px; }
    </style>
</head>
<body>

<div id="layout">
    <div id="map"></div>
    <div id="side-info">
        <div id="welcome" class="welcome-screen">
            <h2 style="color:#2c3e50">ğŸŒ ä¸–ç•Œåœ°åœ–æ¢ç´¢å™¨</h2>
            <p>è«‹åœ¨åœ°åœ–ä¸Šé»æ“Šä»»ä½•åœ‹å®¶</p>
            <p>å³å¯åœ¨æ­¤è™•æŸ¥çœ‹è©³ç´°çš„åœ‹æ——ã€äººå£ã€é¦–éƒ½èˆ‡æ­·å²ç°¡ä»‹</p>
        </div>
        <div id="content" class="content-screen">
            <img id="c-flag" class="flag-box" src="">
            <h1 id="c-name">åœ‹å®¶åç¨±</h1>
            <div class="detail-row"><b>é¦–éƒ½ï¼š</b><span id="c-capital"></span></div>
            <div class="detail-row"><b>äººå£ï¼š</b><span id="c-pop"></span></div>
            <div class="detail-row"><b>å€åŸŸï¼š</b><span id="c-region"></span></div>
            <div class="history-box">
                <h3 style="margin-top:0">ğŸ“œ åœ‹å®¶ç°¡ä»‹</h3>
                <div id="c-wiki">è¼‰å…¥ä¸­...</div>
            </div>
            <a id="c-link" href="#" target="_blank" style="display:block; margin-top:20px; color:#3498db; text-decoration:none; font-weight:bold;">ğŸ‘‰ å‰å¾€ç¶­åŸºç™¾ç§‘é–±è®€å…¨æ–‡</a>
        </div>
    </div>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
    // åœ‹åç¿»è­¯å°ç…§è¡¨ (ç¢ºä¿ä»‹ç´¹ä¸æœƒå‡ºç¾ Undefined)
    const translator = {
        "Taiwan": "è‡ºç£", "Japan": "æ—¥æœ¬", "South Korea": "éŸ“åœ‹", "China": "ä¸­åœ‹",
        "United States of America": "ç¾åœ‹", "USA": "ç¾åœ‹", "France": "æ³•åœ‹",
        "Germany": "å¾·åœ‹", "United Kingdom": "è‹±åœ‹", "Italy": "ç¾©å¤§åˆ©", "Russia": "ä¿„ç¾…æ–¯"
    };

    // 1. åˆå§‹åŒ–åœ°åœ–
    const map = L.map('map', { center: [20, 10], zoom: 3, worldCopyJump: false });

    // 2. è¡›æ˜Ÿåº•åœ– (æœ€ç©©å®šä¾†æº)
    L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}').addTo(map);

    // 3. è¼‰å…¥å„åœ‹æ•¸æ“šèˆ‡ä»‹ç´¹é‚è¼¯
    fetch('https://raw.githubusercontent.com/datasets/geo-countries/master/data/countries.geojson')
        .then(res => res.json())
        .then(data => {
            L.geoJSON(data, {
                style: { color: "rgba(255,255,255,0.4)", weight: 1, fillOpacity: 0 },
                onEachFeature: function (feature, layer) {
                    const engName = feature.properties.ADMIN;
                    const zhName = translator[engName] || engName;

                    layer.on('mouseover', function() {
                        this.setStyle({ fillColor: "#3498db", fillOpacity: 0.3 });
                        this.bindTooltip(zhName, { sticky: true }).openTooltip();
                    });

                    layer.on('mouseout', function() { this.setStyle({ fillOpacity: 0 }); });

                    // é»æ“Šå¾Œï¼Œå³å´é¢æ¿é¡¯ç¤ºã€Œä»‹ç´¹ã€
                    layer.on('click', function(e) {
                        map.fitBounds(e.target.getBounds());
                        fetchIntro(engName, zhName);
                    });
                }
            }).addTo(map);
        });

    async function fetchIntro(engName, zhName) {
        document.getElementById('welcome').style.display = 'none';
        document.getElementById('content').style.display = 'block';
        document.getElementById('c-name').innerText = zhName;
        document.getElementById('c-wiki').innerText = "æ­£åœ¨è’é›†è©²åœ‹è³‡è¨Š...";

        try {
            // åŒæ™‚æŠ“å–åœ‹æ——èˆ‡ç™¾ç§‘ä»‹ç´¹
            const [countryRes, wikiRes] = await Promise.all([
                fetch(`https://restcountries.com/v3.1/name/${engName}?fullText=true`),
                fetch(`https://zh.wikipedia.org/api/rest_v1/page/summary/${encodeURIComponent(zhName)}`)
            ]);

            const countryData = (await countryRes.json())[0];
            const wikiData = await wikiRes.json();

            // æ›´æ–°é¢æ¿å…§å®¹
            document.getElementById('c-flag').src = countryData.flags.png;
            document.getElementById('c-capital').innerText = countryData.capital ? countryData.capital[0] : "ç„¡";
            document.getElementById('c-pop').innerText = countryData.population.toLocaleString() + " äºº";
            document.getElementById('c-region').innerText = countryData.subregion || "ç„¡";
            document.getElementById('c-wiki').innerText = wikiData.extract || "ç›®å‰æš«ç„¡è©³ç´°æ–‡å­—ä»‹ç´¹ã€‚";
            document.getElementById('c-link').href = `https://zh.wikipedia.org/wiki/${encodeURIComponent(zhName)}`;

        } catch (err) {
            document.getElementById('c-wiki').innerText = "æŠ±æ­‰ï¼Œç„¡æ³•å¾ä¼ºæœå™¨å–å¾—è©³ç´°ä»‹ç´¹ï¼Œè«‹é»æ“Šé€£çµæŸ¥çœ‹ã€‚";
        }
    }
</script>
</body>
</html>
