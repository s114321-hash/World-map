<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å…¨çƒåœ°ç†è³‡è¨Šæ¢ç´¢ç³»çµ±</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        body, html { margin: 0; padding: 0; height: 100%; overflow: hidden; background: #000; font-family: "Microsoft JhengHei", sans-serif; }
        #map { height: 100vh; width: 100%; }

        /* è³‡è¨Šå¡æ¨£å¼ */
        .info-card { max-width: 280px; text-align: left; }
        .info-card h3 { margin: 5px 0; color: #2c3e50; border-bottom: 2px solid #3498db; padding-bottom: 5px; }
        .info-card img.flag { width: 100%; height: auto; border: 1px solid #ddd; margin: 10px 0; border-radius: 4px; }
        .info-card p { margin: 5px 0; font-size: 14px; color: #555; line-height: 1.5; }
        .wiki-link { display: block; background: #3498db; color: white !important; padding: 8px; text-align: center; text-decoration: none; border-radius: 5px; margin-top: 10px; font-weight: bold; }
    </style>
</head>
<body>

    <div id="map"></div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        // 1. åˆå§‹åŒ–åœ°åœ–
        const map = L.map('map', {
            center: [20, 0],
            zoom: 3,
            maxBounds: [[-90, -180], [90, 180]],
            worldCopyJump: true
        });

        // 2. è¡›æ˜Ÿåº•åœ–
        L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}').addTo(map);

        // 3. è¼‰å…¥å…¨çƒ 200+ åœ‹å®¶çš„é‚Šç•Œæ•¸æ“š (ä½¿ç”¨ç©©å®š CDN)
        const geojsonUrl = 'https://raw.githubusercontent.com/datasets/geo-countries/master/data/countries.geojson';

        fetch(geojsonUrl)
            .then(res => res.json())
            .then(data => {
                L.geoJSON(data, {
                    style: {
                        color: "white",
                        weight: 0.8,
                        fillColor: "#3498db",
                        fillOpacity: 0.05
                    },
                    onEachFeature: function (feature, layer) {
                        // æŠ“å–åœ‹å®¶åç¨±
                        const countryName = feature.properties.ADMIN || feature.properties.name;

                        // äº’å‹•æ•ˆæœ
                        layer.on('mouseover', function() {
                            this.setStyle({ fillOpacity: 0.3 });
                            this.bindTooltip(countryName).openTooltip();
                        });
                        layer.on('mouseout', function() {
                            this.setStyle({ fillOpacity: 0.05 });
                        });

                        // é»æ“Šäº‹ä»¶ï¼šç²å–å…¨çƒè³‡è¨Š
                        layer.on('click', async function(e) {
                            const popup = L.popup({ className: 'info-card' })
                                .setLatLng(e.latlng)
                                .setContent(`<div><h3>${countryName}</h3><p>â³ æ­£åœ¨èª¿é–±å…¨çƒè³‡æ–™åº«...</p></div>`)
                                .openOn(map);

                            try {
                                // åŒæ™‚å‘ RestCountries æŠ“åœ‹æ——ã€å‘ Wikipedia æŠ“ç°¡ä»‹
                                const [cRes, wRes] = await Promise.all([
                                    fetch(`https://restcountries.com/v3.1/name/${encodeURIComponent(countryName)}?fullText=true`),
                                    fetch(`https://zh.wikipedia.org/api/rest_v1/page/summary/${encodeURIComponent(countryName)}`)
                                ]);

                                const cData = (await cRes.json())[0];
                                const wData = await wRes.json();

                                // é¡¯ç¤ºä¸­æ–‡åç¨±ï¼ˆå¦‚æœæœ‰çš„è©±ï¼‰ï¼Œå¦å‰‡ç”¨è‹±æ–‡
                                const displayName = cData.translations.zho ? cData.translations.zho.common : countryName;

                                popup.setContent(`
                                    <div class="info-card">
                                        <h3>${displayName}</h3>
                                        <img src="${cData.flags.png}" class="flag">
                                        <p><b>ğŸ›ï¸ é¦–éƒ½ï¼š</b> ${cData.capital ? cData.capital[0] : 'ç„¡è³‡æ–™'}</p>
                                        <p><b>ğŸ‘¥ äººå£ï¼š</b> ${cData.population.toLocaleString()} äºº</p>
                                        <p>${wData.extract ? wData.extract.substring(0, 120) + '...' : 'é»æ“Šä¸‹æ–¹é€£çµæŸ¥çœ‹è©³ç´°ä»‹ç´¹ã€‚'}</p>
                                        <a href="https://zh.wikipedia.org/wiki/${encodeURIComponent(displayName)}" target="_blank" class="wiki-link">é–±è®€ç™¾ç§‘å…¨æ–‡</a>
                                    </div>
                                `);
                            } catch (error) {
                                popup.setContent(`
                                    <div class="info-card">
                                        <h3>${countryName}</h3>
                                        <p>ç„¡æ³•å–å¾—è‡ªå‹•æ‘˜è¦ï¼Œå»ºè­°ç›´æ¥æŸ¥çœ‹ç™¾ç§‘ã€‚</p>
                                        <a href="https://zh.wikipedia.org/wiki/${encodeURIComponent(countryName)}" target="_blank" class="wiki-link">å‰å¾€ç¶­åŸºç™¾ç§‘</a>
                                    </div>
                                `);
                            }
                        });
                    }
                }).addTo(map);
            });
    </script>
</body>
</html>
