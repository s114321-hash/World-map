<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å…¨çƒåœ°ç†è³‡è¨Šæ¢ç´¢ç³»çµ±</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        body, html { margin: 0; padding: 0; height: 100%; overflow: hidden; background: #000; font-family: "Microsoft JhengHei", sans-serif; }
        #main-container { display: flex; height: 100vh; width: 100vw; }
        #map { flex: 1; background: #001529; }
        
        /* å³å´ä»‹ç´¹é¢æ¿ */
        #side-panel {
            width: 350px;
            background: #fff;
            box-shadow: -2px 0 10px rgba(0,0,0,0.5);
            z-index: 1000;
            padding: 25px;
            overflow-y: auto;
            display: none; /* åˆå§‹éš±è— */
        }

        .flag-img { width: 100%; border-radius: 4px; box-shadow: 0 2px 8px rgba(0,0,0,0.2); }
        .country-title { font-size: 28px; margin: 15px 0 5px 0; color: #2c3e50; }
        .data-item { margin: 10px 0; color: #555; border-bottom: 1px solid #eee; padding-bottom: 5px; }
        .data-item b { color: #34495e; }
        .wiki-brief { font-size: 15px; line-height: 1.6; color: #444; margin-top: 15px; }
        .btn-more { display: inline-block; margin-top: 15px; padding: 10px 20px; background: #3498db; color: #fff; text-decoration: none; border-radius: 5px; }
        
        /* åœ°åœ–æ¨™ç±¤ */
        .leaflet-tooltip { background: rgba(0,0,0,0.8); color: #fff; border: none; font-weight: bold; }
    </style>
</head>
<body>

<div id="main-container">
    <div id="map"></div>
    <div id="side-panel">
        <div id="info-content">
            <p>é»æ“Šåœ°åœ–åœ‹å®¶ä»¥æŸ¥çœ‹è©³ç´°ä»‹ç´¹...</p>
        </div>
    </div>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
    // åœ‹åä¸­æ–‡ç¿»è­¯è¡¨ (é˜²æ­¢è·³è½‰åˆ° Undefined)
    const translate = {
        "Taiwan": "è‡ºç£", "Japan": "æ—¥æœ¬", "China": "ä¸­åœ‹", "USA": "ç¾åœ‹", 
        "United States of America": "ç¾åœ‹", "France": "æ³•åœ‹", "Germany": "å¾·åœ‹", 
        "South Korea": "éŸ“åœ‹", "United Kingdom": "è‹±åœ‹", "Russia": "ä¿„ç¾…æ–¯"
    };

    // 1. åˆå§‹åŒ–åœ°åœ–ï¼Œè¨­å®šä¸é‡è¤‡é¡¯ç¤º
    const map = L.map('map', {
        center: [20, 0],
        zoom: 3,
        worldCopyJump: false, // é˜²æ­¢è·³èº
        noWrap: true          // é˜²æ­¢åœ°åœ–é‡è¤‡
    });

    // 2. è¡›æ˜Ÿåº•åœ–
    L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
        noWrap: true,
        bounds: [[-90, -180], [90, 180]]
    }).addTo(map);

    // 3. è¼‰å…¥é‚Šç•Œèˆ‡é»æ“Šé‚è¼¯
    fetch('https://raw.githubusercontent.com/datasets/geo-countries/master/data/countries.geojson')
        .then(res => res.json())
        .then(data => {
            L.geoJSON(data, {
                style: { color: "rgba(255,255,255,0.4)", weight: 1, fillOpacity: 0 },
                onEachFeature: function (feature, layer) {
                    const engName = feature.properties.ADMIN;
                    const chName = translate[engName] || engName;

                    layer.on('mouseover', function() {
                        this.setStyle({ fillColor: "#f1c40f", fillOpacity: 0.3 });
                        this.bindTooltip(chName).openTooltip();
                    });

                    layer.on('mouseout', function() {
                        this.setStyle({ fillOpacity: 0 });
                    });

                    layer.on('click', async function(e) {
                        map.fitBounds(e.target.getBounds());
                        showDetail(engName, chName);
                    });
                }
            }).addTo(map);
        });

    async function showDetail(engName, chName) {
        const panel = document.getElementById('side-panel');
        const content = document.getElementById('info-content');
        panel.style.display = 'block';
        content.innerHTML = `<p>ğŸš€ æ­£åœ¨èª¿é–± ${chName} çš„æ©Ÿå¯†è³‡æ–™...</p>`;

        try {
            // æŠ“å–åœ‹å®¶è³‡æ–™
            const res = await fetch(`https://restcountries.com/v3.1/name/${engName}?fullText=true`);
            const cData = await res.json();
            const country = cData[0];

            // æŠ“å–ç¶­åŸºç™¾ç§‘
            const wRes = await fetch(`https://zh.wikipedia.org/api/rest_v1/page/summary/${encodeURIComponent(chName)}`);
            const wData = await wRes.json();

            content.innerHTML = `
                <img src="${country.flags.png}" class="flag-img">
                <h1 class="country-title">${chName}</h1>
                <p style="color:#999; margin-bottom:20px;">${engName}</p>
                
                <div class="data-item"><b>é¦–éƒ½ï¼š</b> ${country.capital ? country.capital[0] : 'N/A'}</div>
                <div class="data-item"><b>äººå£ï¼š</b> ${country.population.toLocaleString()} äºº</div>
                <div class="data-item"><b>å€åŸŸï¼š</b> ${country.subregion}</div>
                
                <div class="wiki-brief">
                    <h3>åœ‹å®¶ç°¡ä»‹</h3>
                    ${wData.extract || 'ç›®å‰æš«ç„¡è©³ç´°ä¸­æ–‡ç°¡ä»‹ã€‚'}
                </div>
                
                <a href="https://zh.wikipedia.org/wiki/${encodeURIComponent(chName)}" target="_blank" class="btn-more">åœ¨ç¶­åŸºç™¾ç§‘é–±è®€æ›´å¤š</a>
            `;
        } catch (err) {
            content.innerHTML = `<h2>${chName}</h2><p>æš«æ™‚ç„¡æ³•å–å¾—è©³ç´°è³‡è¨Šã€‚</p>`;
        }
    }
</script>
</body>
</html>
