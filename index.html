<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å…¨çƒåœ°ç†è³‡è¨Šç³»çµ± - ç¹é«”ç™¾ç§‘ç‰ˆ</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        body, html { margin: 0; padding: 0; height: 100%; overflow: hidden; background: #001a33; font-family: "Microsoft JhengHei", sans-serif; }
        #map { height: 100vh; width: 100%; }

        /* åœ°åœ–å¢äº® */
        .leaflet-tile-pane { filter: brightness(1.2) contrast(1.1); }

        /* è³‡è¨Šå¡ç‰‡ï¼šå¯¬åº¦ç¨å¾®å¢åŠ ä»¥å®¹ç´æ›´å¤šè³‡è¨Š */
        .custom-tooltip {
            background: rgba(255, 255, 255, 0.98);
            border: 2px solid #3498db;
            border-radius: 12px;
            padding: 15px;
            box-shadow: 0 8px 30px rgba(0,0,0,0.5);
            pointer-events: none;
        }
        .tooltip-content { width: 220px; text-align: center; }
        .tooltip-content h3 { margin: 0 0 10px 0; color: #2c3e50; font-size: 20px; border-bottom: 2px solid #3498db; padding-bottom: 5px; font-weight: bold; }
        .tooltip-content img { width: 100%; height: auto; border: 1px solid #ddd; margin-bottom: 12px; border-radius: 6px; }
        
        /* è³‡è¨Šæ¢ç›®æ¨£å¼ */
        .info-item { margin: 6px 0; font-size: 14px; color: #333; text-align: left; display: flex; justify-content: space-between; border-bottom: 1px dashed #eee; padding-bottom: 2px; }
        .data-label { font-weight: bold; color: #2980b9; }
        .data-value { color: #2c3e50; font-weight: 500; }
        .hint { color: #e67e22; font-size: 11px; margin-top: 10px; display: block; font-weight: bold; }
    </style>
</head>
<body>

    <div id="map"></div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        const bounds = L.latLngBounds(L.latLng(-85, -180), L.latLng(85, 180));
        const map = L.map('map', {
            center: [25, 10],
            zoom: 3,
            minZoom: 2,
            maxBounds: bounds,
            maxBoundsViscosity: 1.0,
            worldCopyJump: false,
            zoomControl: false
        });

        L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
            noWrap: true,
            bounds: bounds
        }).addTo(map);

        const geojsonUrl = 'https://cdn.jsdelivr.net/gh/datasets/geo-countries@master/data/countries.geojson';

        fetch(geojsonUrl)
            .then(res => res.json())
            .then(data => {
                L.geoJSON(data, {
                    style: { color: "rgba(255,255,255,0.6)", weight: 1, fillColor: "#3498db", fillOpacity: 0.05 },
                    onEachFeature: function (feature, layer) {
                        const engName = feature.properties.ADMIN || feature.properties.name;

                        layer.on('mouseover', async function (e) {
                            this.setStyle({ fillOpacity: 0.35, weight: 2, color: "#f1c40f" });

                            try {
                                const res = await fetch(`https://restcountries.com/v3.1/name/${encodeURIComponent(engName)}?fullText=true`);
                                const cData = await res.json();
                                const c = cData[0];
                                
                                // ç¹é«”ä¸­æ–‡åè™•ç†
                                let zhName = c.translations?.zho?.common || c.translations?.zho?.official || engName;
                                // ä¿®æ­£å¸¸è¦‹ç°¡é«”å­—
                                zhName = zhName.replace(/å›½/g, 'åœ‹').replace(/å°/g, 'è‡º').replace(/æ¹¾/g, 'ç£').replace(/åŒº/g, 'å€');

                                const capital = c.capital ? c.capital[0] : 'ç„¡';
                                const area = c.area ? c.area.toLocaleString() + ' kmÂ²' : 'ç„¡è³‡æ–™';
                                const languages = c.languages ? Object.values(c.languages).slice(0, 2).join(', ') : 'ç„¡è³‡æ–™';
                                const currencies = c.currencies ? Object.values(c.currencies).map(curr => `${curr.name}(${curr.symbol})`).join(', ') : 'ç„¡è³‡æ–™';
                                const region = c.region || 'ç„¡è³‡æ–™';

                                const content = `
                                    <div class="tooltip-content">
                                        <h3>${zhName}</h3>
                                        <img src="${c.flags.png}">
                                        <div class="info-item"><span class="data-label">ğŸŒ æ‰€å±¬æ´²åˆ¥</span><span class="data-value">${region}</span></div>
                                        <div class="info-item"><span class="data-label">ğŸ“ é¦–éƒ½</span><span class="data-value">${capital}</span></div>
                                        <div class="info-item"><span class="data-label">ğŸ‘¥ äººå£</span><span class="data-value">${c.population.toLocaleString()} äºº</span></div>
                                        <div class="info-item"><span class="data-label">ğŸ“ é¢ç©</span><span class="data-value">${area}</span></div>
                                        <div class="info-item"><span class="data-label">ğŸ—£ï¸ èªè¨€</span><span class="data-value">${languages}</span></div>
                                        <div class="info-item"><span class="data-label">ğŸ’° è²¨å¹£</span><span class="data-value" style="font-size:12px;">${currencies}</span></div>
                                        <span class="hint">é»æ“ŠæŸ¥çœ‹ç¹é«”ç¶­åŸºç™¾ç§‘å…¨æ–‡</span>
                                    </div>
                                `;

                                layer.bindTooltip(content, { sticky: true, className: 'custom-tooltip', opacity: 1, direction: 'top' }).openTooltip();

                            } catch (err) {
                                layer.bindTooltip(`<div style="padding:10px;"><b>${engName}</b><br>è³‡æ–™ç²å–ä¸­...</div>`).openTooltip();
                            }
                        });

                        layer.on('mouseout', function () { this.setStyle({ fillOpacity: 0.05, weight: 1, color: "rgba(255,255,255,0.6)" }); });
                        layer.on('click', function () { window.open(`https://zh.wikipedia.org/zh-tw/${encodeURIComponent(engName)}`, '_blank'); });
                    }
                }).addTo(map);
            });
    </script>
</body>
</html>
