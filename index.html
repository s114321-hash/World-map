<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å…¨çƒåœ°ç†è³‡è¨Šç³»çµ± - ç¹é«”æ¥µè‡´å¡ç‰‡ç‰ˆ</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        body, html { margin: 0; padding: 0; height: 100%; overflow: hidden; background: #001a33; font-family: "Microsoft JhengHei", "PingFang TC", sans-serif; }
        #map { height: 100vh; width: 100%; }

        /* åœ°åœ–å¢äº® */
        .leaflet-tile-pane { filter: brightness(1.15) contrast(1.1); }

        /* è³‡è¨Šå°å¡ç‰‡æ¨£å¼ */
        .custom-tooltip {
            background: rgba(255, 255, 255, 0.98);
            border: none;
            border-radius: 16px;
            padding: 0;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            pointer-events: none;
            overflow: hidden;
        }
        .card-header {
            background: #3498db;
            color: white;
            padding: 12px;
            text-align: center;
            font-size: 20px;
            font-weight: bold;
            letter-spacing: 1px;
        }
        .card-body { padding: 15px; width: 240px; }
        .card-body img { width: 100%; border-radius: 8px; margin-bottom: 12px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
        
        /* ç¶²æ ¼å°å¡ç‰‡ä»‹ç´¹ */
        .info-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .grid-item {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 8px;
            text-align: center;
            border: 1px solid #eee;
        }
        .grid-label { font-size: 11px; color: #7f8c8d; display: block; margin-bottom: 3px; }
        .grid-value { font-size: 13px; color: #2c3e50; font-weight: bold; }
        
        .wiki-hint {
            display: block;
            text-align: center;
            font-size: 11px;
            color: #bdc3c7;
            margin-top: 12px;
        }
    </style>
</head>
<body>

    <div id="map"></div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        const bounds = L.latLngBounds(L.latLng(-85, -180), L.latLng(85, 180));
        const map = L.map('map', {
            center: [25, 10], zoom: 3, minZoom: 2,
            maxBounds: bounds, maxBoundsViscosity: 1.0,
            worldCopyJump: false, zoomControl: false
        });

        L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
            noWrap: true, bounds: bounds
        }).addTo(map);

        // ç¹é«”ä¸­æ–‡å¼·åˆ¶æ ¡æ­£è¡¨ (é‡å° API å¸¸è¦‹ç°¡é«”å­—é€²è¡Œæš´åŠ›æ›¿æ›)
        const toTraditional = (str) => {
            if (!str) return "ç„¡è³‡è¨Š";
            return str.replace(/å›½/g, 'åœ‹').replace(/å°/g, 'è‡º').replace(/æ¹¾/g, 'ç£').replace(/åŒº/g, 'å€')
                      .replace(/ä¹‰/g, 'ç¾©').replace(/å…°/g, 'è˜­').replace(/é©¬/g, 'é¦¬').replace(/äºš/g, 'äº')
                      .replace(/ä¸œ/g, 'æ±').replace(/è¥¿/g, 'è¥¿').replace(/å—/g, 'å—').replace(/åŒ—/g, 'åŒ—')
                      .replace(/è”/g, 'è¯').replace(/é—¨/g, 'é–€').replace(/æ€»/g, 'ç¸½').replace(/å‘/g, 'ç™¼');
        };

        const geojsonUrl = 'https://cdn.jsdelivr.net/gh/datasets/geo-countries@master/data/countries.geojson';

        fetch(geojsonUrl).then(res => res.json()).then(data => {
            L.geoJSON(data, {
                style: { color: "rgba(255,255,255,0.6)", weight: 1, fillColor: "#3498db", fillOpacity: 0.05 },
                onEachFeature: function (feature, layer) {
                    const engName = feature.properties.ADMIN || feature.properties.name;

                    layer.on('mouseover', async function (e) {
                        this.setStyle({ fillOpacity: 0.3, weight: 2, color: "#f1c40f" });

                        try {
                            const res = await fetch(`https://restcountries.com/v3.1/name/${encodeURIComponent(engName)}?fullText=true`);
                            const cData = await res.json();
                            const c = cData[0];
                            
                            // 100% ç¹é«”åŒ–è™•ç†
                            let zhName = toTraditional(c.translations?.zho?.common || engName);
                            let capital = toTraditional(c.capital ? c.capital[0] : 'ç„¡');
                            let region = toTraditional(c.region);
                            let currencies = c.currencies ? Object.values(c.currencies).map(curr => curr.symbol || curr.name).join(', ') : 'ç„¡';

                            const content = `
                                <div class="custom-tooltip">
                                    <div class="card-header">${zhName}</div>
                                    <div class="card-body">
                                        <img src="${c.flags.png}">
                                        <div class="info-grid">
                                            <div class="grid-item"><span class="grid-label">ğŸŒ æ‰€å±¬å€åŸŸ</span><span class="grid-value">${region}</span></div>
                                            <div class="grid-item"><span class="grid-label">ğŸ›ï¸ é¦–éƒ½</span><span class="grid-value">${capital}</span></div>
                                            <div class="grid-item"><span class="grid-label">ğŸ‘¥ äººå£æ•¸é‡</span><span class="grid-value">${(c.population / 10000).toFixed(0)} è¬</span></div>
                                            <div class="grid-item"><span class="grid-label">ğŸ’° è²¨å¹£ç¬¦è™Ÿ</span><span class="grid-value">${currencies}</span></div>
                                            <div class="grid-item"><span class="grid-label">ğŸ“ åœŸåœ°é¢ç©</span><span class="grid-value">${(c.area / 10000).toFixed(1)} è¬kã¡</span></div>
                                            <div class="grid-item"><span class="grid-label">â±ï¸ æ™‚å€</span><span class="grid-value">${c.timezones[0]}</span></div>
                                        </div>
                                        <span class="wiki-hint">é»æ“Šæ»‘é¼ å·¦éµæŸ¥çœ‹ç¶­åŸºç™¾ç§‘å…¨æ–‡</span>
                                    </div>
                                </div>
                            `;

                            layer.bindTooltip(content, { sticky: true, className: 'custom-tooltip', opacity: 1, direction: 'top' }).openTooltip();

                        } catch (err) {
                            layer.bindTooltip(`<div style="padding:10px;"><b>${engName}</b></div>`).openTooltip();
                        }
                    });

                    layer.on('mouseout', function () { this.setStyle({ fillOpacity: 0.05, weight: 1, color: "rgba(255,255,255,0.6)" }); });
                    layer.on('click', function () { window.open(`https://zh.wikipedia.org/zh-tw/${encodeURIComponent(engName)}`, '_blank'); });
                }
            }).addTo(map);
        });
    </script>
</body>
</html>
